# ИСКУССТВЕННАЯ ЖИЗНЬ
ВВЕДЕНИЕ    
--------
Проект является игрой, симулирующей эволюцию и жизнь замкнутой системы __клеток__ (далее _ботов_, чтобы не путаться с клетками поля).
Игра создана с использованием языка Python 3.8 и библиотеки PyGame 2.0.1.  
Действия игры происходят на поле __180x96__ клеток. Каждый ход каждый живой бот выполняет код своего уникального генома (о работе ботов будет рассказано дальше), в результате которого остается либо жив, либо умирает, либо создает своего потомка.

GETTING STARTED  
----------------
1. Склонируйте этот репозиторий
2. `pip install -r requirments.txt`  
3. Запустите файл `main.py`  для начала симуляции или продолжения предыдущей. Симуляция начнется в фоновом режиме
4. Запустите файл `saves_video_player.py` для просмотра результатов симуляции. Используйте колесико мыши для изменения скорости проигрывания и режима отобрвжения (цвет ботов, энергия и минералы)   
В проекте уже есть дэмка симуляции, но, к сожалению, ГитХаб не дал выложить ее достаточно большой, так что она урезана 

СТРУКТУРА
---------
Проект состоит из функций и классов, который логично распределены по всем файлам.  
Далее описаны функции всех файлов
- `consts.py`  - хранение всех глобальных констант, необходимых для работы каждого отдельного файла
- `bot.py` - хранение класса бота 
- `front.py` - класс, отвечающих за обработку данных и вывода их пользователю в ~~ЧЧФ~~ понятном формате 
- `saver.py` - функции, отвечающие за сохранение кадров для отображения и состояния ботов для продолжения симуляции в будущем
- `main.py` - файл, отвечающий за запуск симуляции и инициализирования игры
- `saves_video_player.py` - отображение истории симуляции

ОПИСАНИЕ ПРИНЦИПОВ РАБОТЫ  
-------------------------
Далее описаны файлы более подробно по отдельности
### bot.py
Суть этого файла это хранение класса бота.  
Главной функцией класса является `execute_commands`, как ясно из названия она выполняет код генома бота. Также этот метод использует другие дополнительные функции такие как
- `check_values` для предотвращения отрицательных значений для, к примеру, здоровья ~~метод был добавлен для предотвращения явления ходячих мертвецов~~
- `die_or_kill` для собственной смерти или убийства жертвы
- `more_color` для изменения своего цвета (об этом позже)
- `bot_double` для создания своего потомка
- и других ~~которые постеснялись представляться~~ 

Далее разберем суть работы бота, его _мозга_ и _генома_

Бот представляет из себя клетку ~~в этом бренном мире~~ на общем поле. Он имеет направление (пронумерованы числами 0...7 от северо-западного по часовой стрелке), геном, счетчик команды, координаты на поле, цвет и счетчики энергии (то же самое, что и здоровье) и минералов.  
Поле представляет из сбея набор клеток, в каждой из которых может находиться
- ничего (пустая клетка)
- бот
- стена
- органика (труп бота)  

> Бот живет, чтобы питаться, а умирает, чтобы питались другие 

Бот может питаться двумя способами (кажддый из них эффективен в разных ситуациях)
- фотосинтез
- хищник

В понятие _хищник_ входит не только питание другими живыми ботами, но и падалью.  
Бот при питании фотосинтезом получает определенное количество энергии в зависимости от высоты и сезона  
При хищнеческом образе жизни бот получает часть от энергии и минералов жертвы или, если питается органикой, то лишь минералы. Минералы можно обменивать на энергию ~~по очень выгодному курсу~~.  
Основной _валютой жизни_ является энергия, поэтому минералы используются для ее хранения и как метод получения энергии.  

Геном состоит из 64 команд, они все представлены числом 1...63. Счетчик команды отвечает за текущий номер команды.   
Далее я ~~пытаюсь~~ описываю каждую команду.
* __23__ - поменять свое направление на некоторый параметр (далее мы еще встретим параметр не раз и я буду это называть просто _сделать что-то относительно_)  
Параметр определяется следующей командой (делится на необходимое число)
То есть к текущему направлению прибавляется остаток от следующей команды на 8
* __24__ - повернуться в сторону параметра (далее _относительно_)  
Направление равно остатку от деления параметра на 8
* __25__ - фотосинтез  
Количество энергии, получаемой ботом вычисляется по формуле  
`плюс_энергия = сезон - высота // 6`
Высота делится на 6, потому что поле ~~мысленно~~ разделено на 6 частей, то есть у самого дна, попытавшись сделать фотосинтез, бот получит отрицательный приход энергии, что делает фотосинтез эффективным лишь сверху.  
* __26__, __27__ - движение относительно и абсолютно соответственно.  
Бот меняет направление относительно или абсолютно и пытается двигаться. 
В зависимости от того, что было спереди, и смог ли он передвинуться счетчик команды меняется на 2...6. В будущем многие функции будут иметь подобную механику и я не буду заострять на этом внимания.
* __28__, __29__ - съесть относительно и абсолютно соответственно.  
Бот меняется направление и пытается съесть то, что перед ним.   
Съев органику, бот получает 100 энергии и 150 минералов.  
Если перед ботом другой бот, то он пытается его съесть. Механика неприятная, поэтому если кратко, то бот сначала съедает _панцирь_, который определяется количеством минералов, затем энергию. Также жертва может съесть данного бота.
* __30__, __31__ - посмотреть в относительно или  абсолютно.  
Бот поворачивается и в зависимости от того, что перед ним, меняет счетчик команд, как было описано ранее.
* __32__, __42__, __33__, __52__ - поделиться энергией и минералами относительно и абсолютно.  
Бот поворачивается. Если перед ним живой бот, то они разделяются между собой энергию и минералы поровну
* __34__, __50__, __35__, __52__ - отдать энергию и минералы  
Бот поворачивается. Если перед ним другой бот, то он безвозмездно отдает четверть своих припасов
* __36__ - бот выравнивается по горизонтали.  
с шансом 0.5 поворачивается направо или налево
* __37__ - узнать свою высоту.  
В зависимости от текущей высоты меняется счетчик команд 
* __38__ - узнать сколько энергии
В зависимости от количества энергии меняется счетчик команд
* __39__ - узнать сколько минералов  
Опять же в зависимости от количества минералов миняется счетчик
* __40__ - размножение с созданием связанного с данным ботом потомка.  
Если бот окружен со всех сторон или если у него не хватило энергии (150) для размножения, то он в муках умирает  
Иначе создает потомка, с которым делит минералы и энергию пополам и копирует в него свой геном.  
С шансом 0.25 один ген у потомка поменяется на другой случайным. Также потомок попадает в колонию своего предка. Колонии не могут передвигаться, но боты деляется между собой энергией и минералами.   
* __41__ - размножение с созданием свободного потомка  
Все то же самое размножение, но потомок не попадает в колонию предка
* __43__ - есть ли приход энергии  
Если бот в зоне, где можно выполнить фотосинтез то счетчик команд прибавляется на 1, иначе на 2
* __46__ - многоклеточный ли я  
То же самое, что и в команде __43__, но с многоклеточностью
* __47__ - преобразовать минералы в энергию  
100 минералов преобразуются в энергию с коэффициентом 4
* __48__ - мутировать  
Заменяется случайный ген в своем геноме на другой случайный
* __49__ - генная атака  
Если перед ботом другой бот, то у того меняется случайный ген
* Если ген не соответствует никакой команде, то к счетчику команд просто прибаляется 



### main.py
Файл содежит в себе класс игры в целом, ее инициализацию и главный игровой цикл  
При запуске файла происходит вот такое
```python
 genesis = Game()  
 genesis.init_world()
```
Рассмотрим строчки по отдельности
1. класс Game  
Этот класс является основным для игры. Он реализует каждый ход.  
В ход входит:
    * выполнение генома каждого бота
    ```python
    while self.bot_count < len(self.bots):
        self.bots[self.bot_count].execute_commands()
    ```
    * радиация  
    В верхнем слою у каждого бота меняется случайный ген  
    Она была создана, чтобы в самом начале происходили изменения  
    * передвижение органики вниз
    * сохранение матрицы состояний и кадра на диск
    ```python
    save_new_snapshot(file_name + '.gns', snapshot)
    save_new_matrix(file_name + '_matrix.gns', self.bots, self.world)
    ```

2. инициализация мира  
При инициализации мира происходит загрузка мира с диска, если такое сохранение есть.  
Иначе создается пустой мир с одним ботом. 
    ```python
    self.world = [[0 for _ in range(WORLD_WIDTH)] for __ in range(WORLD_HEIGHT)]
    self.bots = []
    self.prev_world, self.prev_bots = deepcopy(self.world), deepcopy(self.bots)
    adam = Bot(0, WORLD_WIDTH // 2, [25] * 64, 500, 500, 3)
    adam.direction = randint(0, 7)
    self.world[adam.y][adam.x] = adam.index
    self.bots.append(adam)
    ```
    Адам находится в самом верхну мира по середине по ширине. Его гены состоят только из команд фотосинтеза.  
    Благодаря радиации Адаму может повести и он начнет производить себе подобных. __Однако__ все зависит от случая и может произойти так, что о, к примеру, начнет бесконечно двигаться и умрет ~~а может его убьет его сын~~  
    
### saver.py
Данный файл отвечает за сохранение состояний игры и кадров на диск. 
Есть функции для: 
* создания кадра  
Кадр хранит в себе лишь изменения, чтобы не занимать много места на диске ~~хотя и так гитхаб не дал дэмку больше 100мб закинуть, а ведь там началось самое интересное~~.  
* сохранения кадра в файл  
* создания матрицы состояний  
Переводит все поле и характеристики всех ботов в текст
* сохранение матрицы состояний  

### front.py
Просто классический класс для рендера поля

### saves_video_player.py
Данный файл загружает из файлов сохранения и показывает пользователю средствами PyGame

ВОЗМОЖНЫЕ ДОДЕЛКИ
-----------------
* ___оптимизация___  
Ох уж это слово... _оптимизация_... 
Необходимо распараллелить процессы ~~с предложениями писать в [телегу](https://t.me/Mige1ito).~~
* лучше ___дизайн___  
Отображение количества живых ботов, сезон, номер хода  
* дайте мощный ___сервер___   
Конечно, выполнять симуляцию на ноуте, которая съедает целое ядро, каждый день параллельно работе за ним, это интересно и __тепло__, однако, не хочется.  
А вот будь у меня сервер, который выполнял бы это неделями без перерыва... ~~опять же с предложениями отдать сервер даром писать в [телегу](https://t.me/Mige1ito).~~